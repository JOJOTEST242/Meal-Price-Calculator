<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>餐點價格計算器</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  h1, h2 { margin-top: 20px; }
  table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  input { width: 60px; }
  .total { font-weight: bold; font-size: 1.2em; }
  .high { color: red; }
  button { padding: 6px 12px; margin: 5px; font-size: 0.95em; }
  .custom-section { border: 1px solid #aaa; padding: 10px; margin-bottom: 20px; }
  select { width: 120px; }
</style>
</head>
<body>

<h1>餐點價格計算器</h1>

<button onclick="clearPrices()">清空價格</button>

<div id="meals"></div>

<h2>自訂餐點</h2>
<div class="custom-section">
  <input type="text" id="customMealName" placeholder="餐點名稱">
  <button onclick="addCustomMeal()">新增餐點</button>
  <div id="customMealsContainer"></div>
</div>

<p class="total">三餐總計：<span id="grandTotal">0</span> 元</p>

<script>
const foodOptions = ['A雞腿','B肉串','C雞屁股','D米腸','E甜不辣','F豬血糕','G丸子','H鑫鑫腸','I豆腐','J雞翅'];

let meals = [
  { name: "餐點1", items: [
      { name: "A雞腿", qty: 1 },
      { name: "B肉串", qty: 4 },
      { name: "C雞屁股", qty: 3 },
      { name: "D米腸", qty: 2 }
    ]
  },
  { name: "餐點2", items: [
      { name: "A雞腿", qty: 1 },
      { name: "E甜不辣", qty: 2 },
      { name: "F豬血糕", qty: 2 }
    ]
  },
  { name: "餐點3", items: [
      { name: "G丸子", qty: 3 },
      { name: "E甜不辣", qty: 2 },
      { name: "F豬血糕", qty: 4 },
      { name: "H鑫鑫腸", qty: 3 },
      { name: "C雞屁股", qty: 2 },
      { name: "I豆腐", qty: 3 },
      { name: "J雞翅", qty: 1 }
    ]
  }
];

function renderMeals() {
  const container = document.getElementById("meals");
  container.innerHTML = "";
  meals.forEach((meal, mealIndex) => {
    const table = document.createElement("table");
    table.innerHTML = `<tr><th colspan="5">${meal.name}</th></tr>
                       <tr><th>食物</th><th>數量</th><th>單價(元)</th><th>小計(元)</th><th>操作</th></tr>`;
    meal.items.forEach((item, itemIndex) => {
      let savedPrice = localStorage.getItem(`meal${mealIndex}_item${itemIndex}`) || 0;
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${item.name}</td>
        <td>${item.qty}</td>
        <td><input type="number" min="0" value="${savedPrice}" data-meal="${mealIndex}" data-item="${itemIndex}" oninput="updateTotal()"></td>
        <td><span id="subtotal-${mealIndex}-${itemIndex}">0</span></td>
        <td>${mealIndex >= 3 ? '<button onclick="removeCustomItem('+mealIndex+','+itemIndex+')">刪除</button>' : ''}</td>
      `;
      table.appendChild(row);
    });
    table.innerHTML += `<tr><td colspan="3" class="total">小計</td><td class="total" id="mealTotal-${mealIndex}">0</td><td></td></tr>`;
    container.appendChild(table);
  });
  updateTotal();
}

function updateTotal() {
  let grandTotal = 0;
  meals.forEach((meal, mealIndex) => {
    let mealTotal = 0;
    meal.items.forEach((item, itemIndex) => {
      const priceInput = document.querySelector(`input[data-meal='${mealIndex}'][data-item='${itemIndex}']`);
      const price = parseFloat(priceInput.value) || 0;
      localStorage.setItem(`meal${mealIndex}_item${itemIndex}`, price);
      const subtotal = price * item.qty;
      const subtotalSpan = document.getElementById(`subtotal-${mealIndex}-${itemIndex}`);
      subtotalSpan.innerText = subtotal.toFixed(0);
      mealTotal += subtotal;
    });
    const mealTotalElem = document.getElementById(`mealTotal-${mealIndex}`);
    mealTotalElem.innerText = mealTotal.toFixed(0);
    mealTotalElem.className = mealTotal > 200 ? 'total high' : 'total';
    grandTotal += mealTotal;
  });
  document.getElementById("grandTotal").innerText = grandTotal.toFixed(0);
}

function clearPrices() {
  meals.forEach((meal, mealIndex) => {
    meal.items.forEach((item, itemIndex) => {
      localStorage.removeItem(`meal${mealIndex}_item${itemIndex}`);
    });
  });
  renderMeals();
}

// 自訂餐點功能
function addCustomMeal() {
  const name = document.getElementById("customMealName").value.trim();
  if(!name) { alert("請輸入餐點名稱"); return; }
  const newMeal = { name: name, items: [] };
  meals.push(newMeal);
  renderCustomMeals();
  document.getElementById("customMealName").value = "";
}

function renderCustomMeals() {
  const container = document.getElementById("customMealsContainer");
  container.innerHTML = "";
  meals.forEach((meal, mealIndex) => {
    if(mealIndex < 3) return; // 只處理自訂餐點
    const div = document.createElement("div");
    div.className = "custom-section";
    div.innerHTML = `<h3>${meal.name} <button onclick="removeCustomMeal(${mealIndex})">刪除餐點</button></h3>`;
    const addItemDiv = document.createElement("div");
    addItemDiv.innerHTML = `選擇食物：
      <select id="foodSelect-${mealIndex}">${foodOptions.map(f=>`<option value="${f}">${f}</option>`).join('')}</select>
      數量：<input type="number" id="qtyInput-${mealIndex}" min="1" value="1">
      <button onclick="addItemToCustomMeal(${mealIndex})">新增食物</button>`;
    div.appendChild(addItemDiv);
    container.appendChild(div);
  });
  renderMeals();
}

function addItemToCustomMeal(mealIndex) {
  const food = document.getElementById(`foodSelect-${mealIndex}`).value;
  const qty = parseInt(document.getElementById(`qtyInput-${mealIndex}`).value) || 1;
  meals[mealIndex].items.push({ name: food, qty: qty });
  renderCustomMeals();
}

function removeCustomMeal(mealIndex) {
  if(confirm("確定刪除這個自訂餐點嗎？")) {
    meals.splice(mealIndex,1);
    renderCustomMeals();
  }
}

function removeCustomItem(mealIndex, itemIndex) {
  if(confirm("確定刪除這個食物嗎？")) {
    meals[mealIndex].items.splice(itemIndex,1);
    renderCustomMeals();
  }
}

// 初始化
renderMeals();
renderCustomMeals();
</script>

</body>
</html>
